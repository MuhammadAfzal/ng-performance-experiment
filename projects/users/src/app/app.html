<div class="p-8">
  <h1 class="text-2xl font-bold mb-4">User Management</h1>
  <button (click)="refreshData()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">
    Refresh User List
  </button>

  <button (click)="shuffleUsers()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4 ml-2">
    Shuffle User List
  </button>

  <ul>
    <!-- BAD PRACTICE: Tracking by $index for dynamic lists -->
    @for (user of users; track user.id) {
    <li class="p-2 border-b flex justify-between bg-white hover:bg-gray-50">
      <span>{{ user.name }}</span>
      <span class="text-gray-500">{{ user.role }}</span>
    </li>
    }
  </ul>
</div>

<div class="p-8">
  <h1 class="text-3xl font-extrabold mb-6">Memory Leak Experiment</h1>

  <button
    (click)="toggleDetails()"
    class="bg-black text-white px-6 py-3 rounded-md hover:bg-gray-800 transition-colors"
  >
    {{ showDetails ? 'Close Details' : 'Open User Details' }}
  </button>

  @if (showDetails) {
  <!-- When this is removed, it SHOULD stop all logic, but the leak prevents it -->
  <app-user-details />
  }

  <div class="mt-10 p-4 bg-gray-100 rounded italic text-gray-600">
    Check your browser console. Open and Close the details multiple times and watch how the "Ghost"
    logs multiply!
  </div>
</div>
